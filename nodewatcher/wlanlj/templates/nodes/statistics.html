{% extends "base.html" %}
{% load i18n %}
{% load nodestatus %}
{% load misc %}

{% block title %}{% trans "Network Statistics" %}{% endblock %}
{% block heading %}{% trans "Network Statistics" %}{% endblock %}

{% block content %}
<div class="networksummary">
  <h2>Nodes</h2>
<table class="layout">
<tr>
{% for s in nodes_by_status %}
<td class="node_status_{{ s.status }} nodes" style="width: {{ nodes_by_status|widthlist }}%;" ><img src="/images/status_{{ s.status }}_big.png" title="{{ s.status }} - {% statusdesc s.status %}" alt="{{ s.status }}"/> {{ s.count }}</td>
{% empty %}
<td class="notice">
  {% trans "There are currently no nodes registered/visible." %}
</td>
{% endfor %}
</tr>
</table>

<div>
{% trans "All registered/visible nodes:" %} {{ node_count }}<br/>
{% trans "Nodes with warnings:" %} {{ nodes_warned }}<br/>
{% trans "Nodes with an external antenna:" %} {{ external_ant }}<br/>
{% trans "Test nodes:" %} {{ nodes_test }}<br/>
</div>

<h3 id="routers_folder" class="folding closed">{% trans "Nodes by router type" %}</h3>
  <div style="padding-left: 20px;" id="routers_foldee">
    <table border="0" style="width: 90%; !important;" class="listing">
    {% for t in template_usage %}
    <tr class="{% cycle 'odd' 'even' %}">
      <td>{% if t.special %}<i>{% endif %}{{ t.template }}{% if t.special %}</i>{% endif %}</td>
      <td>{{ t.count }}</td>
    </tr>
    {% empty %}
    <tr>
      <td class="notice">
        {% trans "There are currently no nodes registered/connected." %}
      </td>
    </tr>
    {% endfor %}
    </table>
  </div>

<h3 id="projects_folder" class="folding closed">{% trans "Nodes by project" %}</h3>
  <div style="padding-left: 20px;" id="projects_foldee">
    <table border="0" style="width: 90%; !important;" class="listing">
    {% for p in nodes_by_project %}
    <tr class="{% cycle 'odd' 'even' %}">
      <td>{% if p.special %}<i>{% endif %}{{ p.name }}{% if p.special %}</i>{% endif %}</td>
      <td>{{ p.count }}</td>
    </tr>
    {% empty %}
    <tr>
      <td class="notice">
        {% trans "There are currently no nodes registered/connected." %}
      </td>
    </tr>
    {% endfor %}
    </table>
  </div>

  <h2>Clients</h2>
  {% trans "Clients connected so far" %}: {{ clients_ever }}<br/>
  <h2>Network</h2>  
  {% trans "Number of subnets" %}: {{ subnet_count }}<br/>
  {% trans "Average peers per node" %}: {{ peers_avg }}<br/>
</div>
<h2>Graphs</h2>
<div class="graphs">
<div class="timespan">
  {% for timespan in timespans reversed %}
  <a href="#" id="timespan_id-{{ timespan }}" onclick="graph_timespan = '{{ timespan }}'; graph_display_changed(); return false;">{% blocktrans %}last {{ timespan }}{% endblocktrans %}</a>
  {% endfor %}
<script type="text/javascript">
/* <![CDATA[ */
  var graph_timespan = '{{ timespans|first }}';
  function graph_display_changed() {
    {% for graph in graphs %}
    $('#graph_{{ graph.id }}').attr('src', '/graphs/' + graph_timespan + '_{{ graph.graph }}' );
    {% endfor %}
    $('a[id|=timespan_id]').removeClass('selected');
    $('a#timespan_id-' + graph_timespan).addClass('selected');
  }
  $(document).ready(function() { graph_display_changed('{{ timespans|first }}'); $(".timespan").floater(); });
/* ]]> */
</script>
</div>
  {% for graph in graphs %}
  {{ graph.render }}<br/>
  {% endfor %}
</div>
{% endblock %}
{% block js %}
<script type="text/javascript" src="/js/jquery.floater.js"></script>
{% endblock %}
