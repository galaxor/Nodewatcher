{% extends "base.html" %}
{% load i18n %}
{% load gmap %}

{% block title %}{% blocktrans with node.name|default:_("unknown") as node_name %}Edit Node {{ node_name }}{% endblocktrans %}{% endblock %}
{% block heading %}{% url view_node node.get_current_id as node_url %}{% blocktrans with node.name|default:_("unknown") as node_name %}Edit Node <a href="{{ node_url }}">{{ node_name }}</a>{% endblocktrans %}{% endblock %}

{% block content %}
{% with "change node" as form_errors_context %}
{% include "form_errors.html" %}
{% endwith %}

<form method="post" action="{% url edit_node node.pk %}">
{% csrf_token %}
<table border="0" width="700">
  <tr>
    <td class="first_column_width">{{ form.name.label }}</td>
    <td>{{ form.name }}</td>
  </tr>
  <tr>
    <td></td>
    <td class="small_text">{% url view_node node.pk as permalink %}{% blocktrans %}If you rename the node do not forget to update links containing node's name you maybe made elsewhere. This is why it is better to use [<a href="{{ permalink }}">permalink</a>] when linking to the node.{% endblocktrans %}</td>
  </tr>
  <tr>
    <td>{{ form.owner.label }}</td>
    <td>{{ form.owner }}</td>
  </tr>
  <tr>
    <td>{{ form.ip.label }}</td>
    <td><b>{{ node.ip }}</b> [<a href="{% url renumber_node node.get_current_id %}">{% trans "renumber" %}</a>]</td>
  </tr>
  <tr>
    <td>{{ form.project.label }}</td>
    <td>{{ form.project }}</td>
  </tr>
  <tr>
    <td>{{ form.node_type.label }}</td>
    <td>{{ form.node_type }}</td>
  </tr>
  <tr class="location_opts">
    <td>{{ form.location.label }}</td>
    <td>{{ form.location }}</td>
  </tr>
  <tr class="location_opts">
    <td></td>
    <td class="small_text">{% trans "Should be an address where the node is located." %}</td>
  </tr>
  <tr class="location_opts">
    <td></td>
    <td><div id="gmap" style="width:398px; height: 298px; margin: 2px;"></div></td>
  </tr>        
  <tr class="location_opts">
    <td>{{ form.geo_lat.label }}</td>
    <td>{{ form.geo_lat }}</td>
  </tr>
  <tr class="location_opts">
    <td>{{ form.geo_long.label }}</td>
    <td>{{ form.geo_long }}</td>
  </tr>
  <tr class="location_opts">
    <td></td>
    <td class="small_text">Click on the map or enter coordinates in <a href="{{ documentation_links.decimal_degrees }}" rel="external">decimal degrees</a> format.</td>
  </tr>
  <tr class="section_title">
    <td colspan="2">{% trans "Antenna Information" %}</td>
  </tr>
  <tr>
    <td>{{ form.ant_external.label }}</td>
    <td>{{ form.ant_external }}</td>
  </tr>
  <tr class="extantenna_opts">
    <td>{{ form.ant_type.label }}</td>
    <td>{{ form.ant_type }}</td>
  </tr>
  <tr class="extantenna_opts">
    <td>{{ form.ant_polarization.label }}</td>
    <td>{{ form.ant_polarization }}</td>
  </tr>
  <tr class="extantenna_opts">
    <td>{{ form.ant_conn.label }}</td>
    <td>{{ form.ant_conn }} (<a href="{{ documentation_links.diversity }}" rel="external">what is this?</a>)</td>
  </tr>
  <tr class="section_title">
    <td colspan="2">{% trans "Additional Options" %}</td>
  </tr>
  {% if user.is_staff %}
  <tr>
    <td>{{ form.system_node.label }}</td>
    <td>{{ form.system_node }}</td>
  </tr>
  <tr>
    <td>{{ form.border_router.label }}</td>
    <td>{{ form.border_router }}</td>
  </tr>
  {% endif %}
  <tr>
    <td>{{ form.redundancy_req.label }}</td>
    <td>{{ form.redundancy_req }}</td>
  </tr>
  <tr>
    <td></td>
    <td class="small_text">{% trans "Warn if node has no direct peering with a border gateway (includes VPN servers)." %}</td>
  </tr>
  <tr class="section_title">
    <td colspan="2">{% trans "Image Generator Options" %}</td>
  </tr>
  <tr>
    <td>{{ form.template.label }}</td>
    <td>{{ form.template }}</td>
  </tr>
  <tr>
    <td></td>
    <td class="small_text">
      {% blocktrans %}You can leave it unconfigured if you are using custom firmware or hardware and you are not
      interested in automatic image building. Maybe use notes field bellow to describe node software, hardware and
      configuration.{% endblocktrans %}
    </td>
  </tr>
  <tr class="imagegen_opts">
    <td>{{ form.channel.label }}</td>
    <td>{{ form.channel }}</td>
  </tr>
  <tr class="imagegen_opts">
    <td>{{ form.use_vpn.label }}</td>
    <td>{{ form.use_vpn }}</td>
  </tr>
  <tr class="imagegen_opts vpn_opts">
    <td>{{ form.tc_egress.label }}</td>
    <td>{{ form.tc_egress }}</td>
  </tr>
  <tr class="imagegen_opts vpn_opts">
    <td>{{ form.tc_ingress.label }}</td>
    <td>{{ form.tc_ingress }}</td>
  </tr>
  <tr class="imagegen_opts vpn_opts">
    <td></td>
    <td class="small_text">This will setup traffic limiting on VPN gateways. Set limits only if and when you notice problems with Internet connection sharing because of the node. In general this is not needed as traffic is already limited by other factors (like wireless connections quality).</td>
  </tr>
  <tr class="imagegen_opts">
    <td>{{ form.use_captive_portal.label }}</td>
    <td>{{ form.use_captive_portal }}</td>
  </tr>
  <tr class="imagegen_opts">
    <td>{{ form.wan_dhcp.label }}</td>
    <td>{{ form.wan_dhcp }}</td>
  </tr>
  <tr class="imagegen_opts">
    <td></td>
    <td class="small_text">If you will not use WAN port leave it auto-configured.</td>
  </tr>
  <tr class="static_opts imagegen_opts" style="display: none;">
    <td>{{ form.wan_ip.label }}</td>
    <td>{{ form.wan_ip }}</td>
  </tr>
  <tr class="static_opts imagegen_opts" style="display: none;">
    <td>{{ form.wan_gw.label }}</td>
    <td>{{ form.wan_gw }}</td>
  </tr>
  <tr class="imagegen_opts">
    <td>{{ form.root_pass.label }}</td>
    <td>{{ form.root_pass }}</td>
  </tr>
  <tr class="imagegen_opts">
    <td></td>
    <td class="small_text">{% trans "This password is used for remote maintenance access to the node. <b>Do not share it with anybody as it can compromise node's and network's security!</b>" %}</td>
  </tr>
  <tr class="imagegen_opts">
    <td valign="top">{{ form.optional_packages.label }}</td>
    <td class="optional_packages">{{ form.optional_packages }}</td>
  </tr>
  <tr>
    <td valign="top">{{ form.notes.label }}</td>
    <td>{{ form.notes }}</td>
  </tr>
  <tr>
    <td></td>
    <td class="small_text">
      {% blocktrans %}These notes are only visible to node's maintainer (that's you). They are public if the node is marked
      as dead and should describe background of node's death.{% endblocktrans %}
    </td>
  </tr>
  <tr>
    <td>{{ form.url.label }}</td>
    <td>{{ form.url }}</td>
  </tr>
  <tr>
    <td></td>
    <td class="small_text">{% trans "You may enter any URL that will be displayed on node's info page." %}</td>
  </tr>
</table>
<div class="buttons"><input type="submit" value="{% trans "Update Node" %}" />
<input type="button" value="{% trans "Cancel" %}" onclick="document.location='{% url view_node node.get_current_id %}'" />
</div>
</form>
{% endblock %}

{% block js %}
<script type="text/javascript">
/* <![CDATA[ */
  var mobileNodeType = {{ mobile_node_type }};
  var projects = {
  {% for project in projects %}{% if project.has_geoloc %}
    {% ifchanged "" %}{% else %},{% endifchanged %}
    {{ project.id }} : {
      "lat": {{ project.geo_lat }},
      "long": {{ project.geo_long }},
      "zoom": {{ project.geo_zoom }}
    }
  {% endif %}{% endfor %}
  };
  var pools = false;
/* ]]> */
</script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/node.js"></script>
{% do_gmap "mapInit" "" node.geo_lat node.geo_long %}
{% endblock %}
