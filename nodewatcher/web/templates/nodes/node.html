{% extends "base.html" %}
{% load i18n %}
{% load gmap %}

{% block title %}{% trans "Node" %} {{ node.name|default:"???" }} ({{ node.ip }}){% endblock %}

{% block content %}
<h1>{% trans "Node Information" %} - {{ node.name|default:"???" }} ({{ node.ip }})</h1>

{% if node.warnings %}
<div class="error">
  {% blocktrans %}<b>WARNING:</b> Some problems were found in this node's configuration! Continued operation of this node might disrupt normal network operations, so these issues must be addressed! The following problems have been detected:{% endblocktrans %}<br />
  <br>
  {% for warning in node.get_warnings %}
  <i>{{ warning }}</i><br/>
  {% endfor %}
</div>
{% endif %}

<table border="0" width="700">
  <tr class="section_title">
    <td colspan="2">
      {% trans "General Information" %}
      {% if current_owner %}&nbsp;[<a href="/nodes/edit/{{ node.ip }}">{% trans "edit" %}</a> | <a href="/nodes/remove/{{ node.ip }}">{% trans "remove" %}</a> | <a href="/nodes/allocate_subnet/{{ node.ip }}">{% trans "add subnet" %}</a>]{% endif %}
    </td>
  </tr>
  <tr>
    <td width="200">{% trans "IP address" %}</td>
    <td>{{ node.ip }}</td>
  </tr>
  <tr>
    <td>{% trans "Name" %}</td>
    <td>{{ node.name|default:"???" }}</td>
  </tr>
  <tr>
    <td>{% trans "Owner" %}</td>
    {% if node.owner %}
    <td><a href="/user/profile/{{ node.owner.id }}">{{ node.owner.username }}</a></td>
    {% else %}
    <td>{% trans "Unknown" %}</td>
    {% endif %}
  </tr>
  <tr>
    <td>{% trans "Location" %}</td>
    <td>{{ node.location|default:_("Unknown") }}</td>
  </tr>
  {% if node.geo_lat and node.geo_long %}
  <tr>
    <td colspan="2">{% gmap lat:46.05 long:14.5 mlat:node.geo_lat mlong:node.geo_long marker:yes clickable:no %}</td>
  </tr>
  {% endif %}
  <tr>
    <td>{% trans "Project" %}</td>
    <td>{{ node.project.name|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "System node" %}</td>
    <td>{% if node.system_node %}{% trans "YES" %}{% else %}{% trans "NO" %}{% endif %}</td>
  </tr>
  <tr>
    <td>{% trans "Border router" %}</td>
    <td>{% if node.border_router %}{% trans "YES" %}{% else %}{% trans "NO" %}{% endif %}</td>
  </tr>
  {% if not node.system_node %}
  <tr class="section_title">
    <td colspan="2">{% trans "Antenna Information" %}</td>
  </tr>
  <tr>
    <td>{% trans "External antenna" %}</td>
    <td>{% if node.ant_external %}{% trans "YES" %}{% else %}{% trans "NO" %}{% endif %}</td>
  </tr>
  <tr>
    <td>{% trans "Type" %}</td>
    <td>{{ node.ant_type_as_string }}</td>
  </tr>
  <tr>
    <td>{% trans "Polarization" %}</td>
    <td>{{ node.ant_polarization_as_string }}</td>
  </tr>
  <tr class="section_title">
    <td colspan="2">
      {% trans "Image Generator Information" %}
      {% if current_owner %}&nbsp;[<a href="/generator/request/{{ node.ip }}">{% trans "generate image" %}</a>]{% endif %}
    </td>
  </tr>
  <tr>
    <td>{% trans "Router type" %}</td>
    <td>{{ node.profile.template.name|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "VPN enabled" %}</td>
    <td>{% if node.profile.use_vpn %}{% trans "YES" %}{% else %}{% trans "NO" %}{% endif %}</td>
  </tr>
  <tr>
    <td>{% trans "Captive portal enabled" %}</td>
    <td>{% if node.profile.use_captive_portal %}{% trans "YES" %}{% else %}{% trans "NO" %}{% endif %}</td>
  </tr>
  <tr class="section_title">
    <td colspan="2">{% trans "Node Configuration" %}</td>
  </tr>
  <tr>
    <td>{% trans "Firmware version" %}</td>
    <td>{{ node.firmware_version|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "BSSID" %}</td>
    <td>{{ node.bssid|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "ESSID" %}</td>
    <td>{{ node.essid|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "Channel" %}</td>
    <td>{{ node.channel|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "Local time" %}</td>
    <td>{{ node.local_time|default:_("Unknown") }}</td>
  </tr>
  <tr>
    <td>{% trans "Connected clients" %}</td>
    <td>{{ node.clients|default:"0" }} [<a href="/nodes/gcl#n{{ node.ip }}">{% trans "global client list" %}</a>]</td>
  </tr>
  {% endif %}
  <tr class="section_title">
    <td colspan="2">{% trans "Status Information" %}</td>
  </tr>
  <tr>
    <td>{% trans "Node status" %}</td>
    <td class="node_status_{{ node.status_as_string }}">{{ node.status_as_string }}</td>
  </tr>
  <tr>
    <td>{% trans "RTT MIN" %}</td>
    <td>{{ node.rtt_min|default:"/" }}</td>
  </tr>
  <tr>
    <td>{% trans "RTT AVG" %}</td>
    <td>{{ node.rtt_avg|default:"/" }}</td>
  </tr>
  <tr>
    <td>{% trans "RTT MAX" %}</td>
    <td>{{ node.rtt_max|default:"/" }}</td>
  </tr>
  <tr>
    <td>{% trans "Packet loss" %} (%)</td>
    <td>{{ node.pkt_loss|default_if_none:"/" }}</td>
  </tr>
  <tr>
    <td>{% trans "Peers" %}</td>
    <td>{{ node.peers }}</td>
  </tr>
  <tr>
  </tr>
  <tr class="section_title">
    <td colspan="2">{% trans "Subnets" %}</td>
  </tr>
  {% if not node.subnet_set.all %}
  <tr>
    <td colspan="2" class="notice">
      {% trans "No subnets are currently assigned or visible." %}
    </td>
  </tr>
  {% else %}
  <tr>
    <td colspan="2" style="padding: 0px; margin: 0px;">
      <table border="0" width="100%" cellpadding="0" cellspacing="0">
        <tr class="inner_header">
          <td>{% trans "Subnet" %}</td>
          <td width="120">{% trans "Status" %}</td>
          <td width="150">{% trans "Last seen" %}</td>
        </tr>
        {% for subnet in node.subnet_set.all %}
        <tr>
          <td>{{ subnet }}{% if current_owner and subnet.allocated %}&nbsp;[<a href="/nodes/deallocate_subnet/{{ subnet.id }}">deallocate</a>]{% endif %}</td>
          <td class="subnet_status_{{ subnet.status_as_string|cut:" " }}">{{ subnet.status_as_string }}</td>
          <td>{{ subnet.last_seen|default:_("never") }}<td>
        </tr>
        {% endfor %}
      </table>
    </td>
  </tr>
  {% endif %}
  <tr class="section_title">
    <td colspan="2">{% trans "Immediate Neighbours / Peers" %}</td>
  </tr>
  {% if not node.peer_list.all %}
  <tr>
    <td colspan="2" class="notice">
      {% trans "Node has no immediate neighbours." %}
    </td>
  </tr>
  {% else %}
  <tr>
    <td colspan="2" style="padding: 0px; margin: 0px;">
      <table border="0" width="100%" cellpadding="0" cellspacing="0">
        <tr class="inner_header">
          <td>{% trans "Node" %}</td>
          <td width="70" align="center">LQ</td>
          <td width="70" align="center">ILQ</td>
          <td width="70" align="center">ETX</td>
        </tr>
        {% for peer in node.dst.all %}
        <tr>
          <td><a href="/nodes/node/{{ peer.src.ip }}">{{ peer.src.name|default:_("unknown") }}</a> ({{ peer.src.ip }})</td>
          <td align="center">{{ peer.lq }}</td>
          <td align="center">{{ peer.ilq }}</td>
          <td align="center">{{ peer.etx }}</td>
        </tr>
        {% endfor %}
      </table>
    </td>
  </tr>
  {% endif %}
  {% if node.get_traffic_graphs %}
  <tr class="section_title">
    <td colspan="2">{% trans "Graphs" %}</td>
  </tr>
  {% for graph in node.get_traffic_graphs %}
  <tr>
    <td colspan="2" align="center"><img src="http://nodes.wlan-lj.net/graphs/{{ graph.graph }}" /></td>
  </tr>
  {% endfor %}
  {% endif %}

</table>
<br /><br/>
{% endblock %}
