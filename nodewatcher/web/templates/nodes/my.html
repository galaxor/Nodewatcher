{% extends "my_base.html" %}
{% load i18n %}
{% load nodestatus %}

{% block title %}{% trans "My Nodes" %}{% endblock %}
{% block heading %}{% trans "My Nodes" %}{% endblock %}

{% block my_content %}

{% if not user.email %}
{% include "nodes/missing_email_error.html" %}
{% endif %}

<table border="0" class="listing">
<thead>
  <tr>
    <th style="width: 4%;"></th>
    <th style="width: 22%;"><b>{% trans "Node name" %}</b></th>
    <th style="width: 15%;"><b>IP</b></th>
    <th style="width: 21%;"><b>{% trans "Last seen up" %}</b></th>
    <th style="width: 8%;" align="center"><b>{% trans "Status" %}</b></th>
    <th style="width: 8%;" align="center"><b>{% trans "Peers" %}</b></th>
    <th style="width: 8%;" align="center"><b>{% trans "Clients" %}</b></th>
    <th style="width: 10%;" align="center"><b>{% trans "Project" %}</b></th>
  </tr>
</thead>
<tfoot>
  <tr>
    <td class="table_menu" colspan="8">
      <a href="{% url new_node %}">{% trans "Add new node" %}</a>
    </td>
  </tr>
</tfoot>
<tbody>
  {% for node in nodes %}
  {% ifchanged node.node_type %}
  <tr class="section_title">
    <td colspan="8"><b>{{ node.node_type_as_string_plural }}</b></td>
  </tr>
  {% endifchanged %}
  <tr class="{% cycle 'odd' 'even' %}">
    <td align="center">
      {% if node.warnings %}
      <a href="{% url view_node node.get_current_id %}">
        <img src="{{ MEDIA_URL }}images/warnings_small.png" title="{% trans "Some problems were detected with this node! Click for details." %}" alt="{% trans "Warning" %}" />
      </a>
      {% endif %}
    </td>
    <td><a href="{% url view_node node.get_current_id %}">{{ node.name|default:_("unknown") }}</a></td>
    <td>{{ node.ip }}</td>
    {% if node.last_seen %}
    <td>{{ node.last_seen|date:"y-m-d H:i:s" }}</td>
    {% else %}
    <td>{% trans "never" %}</td>
    {% endif %}
    <td align="center">{{ node.status_as_string|statusimage:"small" }}</td>
    {% if node.is_down %}
    <td align="center">0</td>
    <td align="center">0</td>
    {% else %}
    <td align="center">{{ node.peers }}</td>
    <td align="center">{{ node.clients|default:"0" }}</td>
    {% endif %}
    <td align="center">{{ node.project|default:_("unknown") }}</td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="8" class="notice">
      {% url new_node as new_node %}{% blocktrans %}You currently have no nodes registered. You can use <i><a href="{{ new_node }}">New node</a></i> tab to register a new node. After the registration you can also generate a flashable firmware image, so you can set up your router directly.{% endblocktrans %}
    </td>
  </tr>
  {% endfor %}
</tbody>
</table>
<div class="legend">
<h3>{% trans "Node status key:" %}</h3>
<ul>
  <li>{{ "up"|status:"small" }} – {% statusdesc "up" %}</li>
  <li>{{ "visible"|status:"small" }} – {% statusdesc "visible" %}</li>
  <li>{{ "down"|status:"small" }} – {% statusdesc "down" %}</li>
  <li>{{ "duped"|status:"small" }} – {% statusdesc "duped" %}</li>
  <li>{{ "invalid"|status:"small" }} – {% statusdesc "invalid" %}</li>
  <li>{{ "new"|status:"small" }} – {% statusdesc "new" %}</li>
  <li>{{ "pending"|status:"small" }} – {% statusdesc "pending" %}</li>
  <li>{{ "awaitingrenumber"|status:"small" }} – {% statusdesc "awaitingrenumber" %}</li>
</ul>
<h3>{% trans "Columns:" %}</h3>
<ul>
  <li><b>Node name</b> – name of the node</li>
  <li><b>IP</b> – <a href="{{ documentation_links.ip_address }}" rel="external">IP address</a> of the node</li>
  <li><b>Last seen up</b> – when was the node last seen connected to the network</li>
  <li><b>Status</b> – current status of the node</li>
  <li><b>Peers</b> – number of nodes in immediate neighborhood to which the node is currently connected</li>
  <li><b>Clients</b> – number of currently connected clients to the node</li>
  <li><b>Project</b> – the project to which the node belongs</li> 
</ul>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
/* <![CDATA[ */
var tablesConfig = [
  {
    "entryName": "nodes",
    "sortColumn": [[2, "asc"]]
  }
];
/* ]]> */
</script>
{% endblock %}
